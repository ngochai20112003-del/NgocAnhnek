<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Trung Thu</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Mali:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --accent: #ff7f50;
            --accent-2: #ff5722;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: "Mali", cursive;
            background: #FFDAB9; 
            overflow: hidden;
        }

        .stage {
            position: relative;
            min-height: 100vh;
            overflow: hidden;
        }

        canvas#starfield {
            display: block;
            width: 100%;
            height: 100%;
        }

            .moon {
                position: absolute;
                top: 60px;
                right: 100px;
                width: 160px; 
                height: 160px; 
                

                background-image: url('BSN.png'); 
                background-size: cover; 
                background-repeat: no-repeat;
                background-position: center;
                border-radius: 50%;

                box-shadow:
                0 0 50px #ffffff7a,
                0 0 80px rgba(255, 255, 255, 0.7),
                0 0 100ox rgba(255, 255, 255, 0.4);
                filter: drop-shadow(0 0 25px rgba(255, 255, 200, 0.8));
                animation: moonGlow 6s ease-in-out infinite;
                z-index: 10;
            }

        @media (max-width:600px) {
            .moon {
                top: 40px;
                right: 14px;
                width: 70px;
                height: 70px;
            }
        }

        #lantern-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 10;
        }

        .lantern {
            position: absolute;
            pointer-events: auto;
            width: 40px;
            user-select: none;
        }

        @keyframes swing {
            0% {
                transform: rotate(-5deg);
            }

            50% {
                transform: rotate(5deg);
            }

            100% {
                transform: rotate(-5deg);
            }
        }

        .swing {
            animation: swing 2s ease-in-out infinite;
        }

        #hint {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0);
            color: #ffa722;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 28px;
            font-weight: 800;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 1000;
            pointer-events: none;
            text-align: center;
            white-space: nowrap;
            text-shadow:
                0 0 15px #ff8a50,
                0 0 20px #ffd180;
        }

        @media (max-width: 600px) {
            #hint {
                font-size: 22px;
                padding: 8px 12px;
            }
        }

        #wish-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.96);
            color: #ff8d22;
            padding: 35px 40px;
            border-radius: 12px;
            font-size: 1.8rem;
            font-weight: 700;
            display: none;
            z-index: 9999;
            text-align: center;
            max-width: 60%;
            box-shadow:
                0 0 20px #ff8a50,
                0 0 25px #ffd180;
            text-shadow:
                0 0 25px #ffd180;
        }

        @media (max-width: 600px) {
            #wish-popup {
                font-size: 1.2rem;
                padding: 20px 25px;
                max-width: 80%;
            }
        }

        .controls {
            position: fixed;
            left: 18px;
            top: 18px;
            z-index: 10;
            color: #fff;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 12px;
            border-radius: 10px;
        }

        .music-toggle {
            cursor: pointer;
            margin-left: 10px;
            color: #fff;
            opacity: 0.95;
        }

        #bottom-image-container {
            position: fixed;
            bottom: 0;
            right: 20px;
            z-index: 5;
            pointer-events: none;
        }

        #bottom-image-container img {
            height: 80px;
            width: auto;
        }

        @media (max-width: 600px) {
            #bottom-image-container img {
                height: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="stage">
        <canvas id="starfield"></canvas>
        <div class="moon"></div>
        <div id="lantern-container"></div>
        <div id="wish-popup"></div>
        <div id="bottom-image-container"></div>

        <!-- Gợi ý xuất hiện sau 1 giây -->
        <div id="hint"> chạm vào hình ảnh nhéeee C ✨</div>

        <audio id="bg-music" loop>
            <source src="HPBD.mp3" type="audio/mp3">
            Trình duyệt của bạn không hỗ trợ thẻ audio.
        </audio>
    </div>

    <script>
        // ===== Hiệu ứng sao =====
        const canvas = document.getElementById("starfield");
        const ctx = canvas.getContext("2d");
        let w, h, stars = [], meteors = [];

        function resizeCanvas() {
            w = canvas.width = innerWidth;
            h = canvas.height = innerHeight;
            stars = [];
            const count = Math.round((w * h) / 2200);
            for (let i = 0; i < count; i++) {
                stars.push({
                    x: Math.random() * w,
                    y: Math.random() * h,
                    r: Math.random() * 0.9 + 0.1,
                    a: Math.random() * 0.8 + 0.2,
                    t: Math.random() * 0.02 + 0.002
                });
            }
        }

        function drawStars() {
            ctx.clearRect(0, 0, w, h);
            for (const s of stars) {
                s.a += (Math.random() > 0.5 ? 1 : -1) * s.t;
                s.a = Math.max(0.05, Math.min(1, s.a));
                ctx.beginPath();
                ctx.globalAlpha = s.a;
                ctx.fillStyle = "#fff";
                ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.globalAlpha = 1;
        }

        function createMeteor() {
            const startX = Math.random() * w;
            const startY = Math.random() * (h / 3);
            const speed = Math.random() * 10 + 6;
            meteors.push({ x: startX, y: startY, vx: speed + 6, vy: speed / 2, len: Math.random() * 120 + 100, a: 1 });
        }

        function drawMeteors() {
            for (let i = meteors.length - 1; i >= 0; i--) {
                const m = meteors[i];
                const x2 = m.x - m.len;
                const y2 = m.y - m.len / 2; 
                const g = ctx.createLinearGradient(m.x, m.y, x2, y2);
                g.addColorStop(0, `rgba(255,255,255,${m.a})`);
                g.addColorStop(1, "rgba(255,255,255,0)");
                ctx.strokeStyle = g;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(m.x, m.y);
                ctx.lineTo(x2, y2);
                ctx.stroke();
                m.x += m.vx; m.y += m.vy; m.a -= 0.02;
                if (m.a <= 0 || m.x > w + 200 || m.y > h + 200) meteors.splice(i, 1);
            }
        }

        function loop() {
            drawStars();
            drawMeteors();
            if (Math.random() < 0.01) createMeteor();
            requestAnimationFrame(loop);
        }

        window.addEventListener("resize", resizeCanvas);
        resizeCanvas(); loop();

        // ===== Đèn lồng =====
        const lanternContainer = document.getElementById("lantern-container");
        const wishes = [
            "Xin chào, chào mừng bạn đã đến đâyyyy",
            "Ngày hôm nay",
            "Cũng như bao ngày khác...",
            "Của người bình thườngg",
            "Còn với C thì chắc là...",
            "Một ngày...",
            "Bình thường nốttt nhỉ ^^",
            "À không, Tớ biết là nay sinh nhật cậu mà ",
            "E è E, Ngày hôm nay của nhiều năm về trước",
            "Là ngày C nói lời chào thân thương với cuộc sống này",
            "Chúng tôi xin vô cùng thường ***. À nhầm, Vô cùng vui mừng được chúc mừng đến C",
            "Sinh nhật vui vẻ nhée",
            "Đừng lo, tuổi tác chỉ là con số nếu bạn giàu thôi!",
            "Chúc cậu luôn trẻ đẹp... à quên, ít nhất là phải tìm được app chụp ảnh đẹp",
            "Chúc cậu nhận được nhiều quà, đủ để bán lại mua kim cương!",
            "Đừng thổi nến mạnh quá, bay mất cái bánh đấy",
            "Nhớ giữ lại cái bánh kem, đừng ăn hết một mình nha!",
            "Happy Birthdayyyyyy"

        ];

        let wishIndex = 0; // để hiển thị theo thứ tự

        function createLantern() {
            const lantern = document.createElement("img");
            lantern.src = "./NG_anh.jpg";
            lantern.className = "lantern swing";
            lantern.style.width = (30 + Math.random() * 40) + "px";
            lantern.style.left = Math.random() * 90 + "vw";
            lantern.style.bottom = "0";
            lantern.style.opacity = 0.9;
            lanternContainer.appendChild(lantern);

            const drift = Math.random() * 140 - 70;
            const up = 120 + Math.random() * 40;
            const duration = 10000 + Math.random() * 3000;

            lantern.animate([{ transform: "translate(0,0)", opacity: 1 },
            { transform: `translate(${drift}px, -${up}vh)`, opacity: 0 }],
                { duration: duration, easing: "linear", fill: "forwards" });

            setTimeout(() => lantern.remove(), duration);

            lantern.addEventListener("click", (e) => {
                e.stopPropagation();
                const wishPopup = document.getElementById("wish-popup");
                wishPopup.textContent = wishes[wishIndex];
                wishPopup.style.display = "block";
                wishIndex = (wishIndex + 1) % wishes.length;
            });
        }

        setInterval(createLantern, 500);

        // ===== Nhạc nền =====
        const bg = document.getElementById("bg-music");
        const hint = document.getElementById("hint");
        let musicStarted = false;

        document.addEventListener("pointerdown", function startMusicOnce() {
            if (!musicStarted && bg) {
                bg.volume = 0;
                bg.play().then(() => {
                    let v = 0;
                    const fadeIn = setInterval(() => {
                        v += 0.05;
                        if (v >= 0.9) { v = 0.9; clearInterval(fadeIn); }
                        bg.volume = v;
                    }, 120);
                    musicStarted = true;
                }).catch(() => { });
            }
            document.removeEventListener("pointerdown", startMusicOnce);
        });

        // ===== Ẩn popup khi click ngoài =====
        document.addEventListener("click", (e) => {
            const pop = document.getElementById("wish-popup");
            if (pop && pop.style.display === "block") {
                pop.style.display = "none";
            }
        });

        // ===== Hiện hint sau 1 giây =====
        window.addEventListener("load", () => {
            setTimeout(() => {
                if (hint) {
                    hint.style.opacity = "1";
                }
                // tự mờ sau 5 giây
                setTimeout(() => {
                    if (hint) hint.style.opacity = "0";
                }, 5000);
            }, 1000);
        });
    </script>
</body>
</html>
